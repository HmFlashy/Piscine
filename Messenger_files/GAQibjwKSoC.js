if (self.CavalryLogger) { CavalryLogger.start_js(["ngZpL"]); }

__d("ChatReliabilityEvents",[],(function a(b,c,d,e,f,g){f.exports={ERROR:"error",CHANNEL_DISCONNECT:"channel_disconnect",CHANNEL_CONNECT:"channel_connect",CHANNEL_INIT:"channel_init",CHANNEL_NOCONFIG:"channel_noconfig",CHANNEL_HISTORY_INVALID:"channel_history_invalid",CHANNEL_STALLED:"channel_stalled",MESSAGE_RECEIVED:"msg_received"};}),null);
__d('ChatReliabilityTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:ChatReliabilityLoggerConfig',this.$ChatReliabilityTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:ChatReliabilityLoggerConfig',this.$ChatReliabilityTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$ChatReliabilityTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$ChatReliabilityTypedLogger1=babelHelpers['extends']({},this.$ChatReliabilityTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$ChatReliabilityTypedLogger1.event=j;return this;};h.prototype.setEventData=function(j){this.$ChatReliabilityTypedLogger1.event_data=j;return this;};var i={event:true,event_data:true};f.exports=h;}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingGroupSetJoinableController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_joinable_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','URI','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupSetApprovalController','XMessagingGroupSetJoinableController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setJoinableMode=function(n,o){var p=c('XMessagingGroupSetJoinableController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatReliabilityInstrumentation',['ChatReliabilityEvents','ChatReliabilityTypedLogger','MercuryConfig'],(function a(b,c,d,e,f,g){'use strict';var h=function j(event,k){if(!c('MercuryConfig').EnableReliabilityLogging)return;new (c('ChatReliabilityTypedLogger'))().setEvent(event).setEventData(k).log();},i={logERROR:function j(k){h(c('ChatReliabilityEvents').ERROR,k);},logCHANNEL_DISCONNECT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_DISCONNECT,k);},logCHANNEL_CONNECT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_CONNECT,k);},logCHANNEL_HISTORY_INVALID:function j(k){h(c('ChatReliabilityEvents').CHANNEL_HISTORY_INVALID,k);},logMESSAGE_RECEIVED:function j(k){h(c('ChatReliabilityEvents').MESSAGE_RECEIVED,k);},logCHANNEL_STALLED:function j(k){h(c('ChatReliabilityEvents').CHANNEL_STALLED,k);},logCHANNEL_INIT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_INIT,k);},logCHANNEL_NOCONFIG:function j(k){h(c('ChatReliabilityEvents').CHANNEL_NOCONFIG,k);}};f.exports=i;}),null);
__d('DocumentTitle',['Arbiter'],(function a(b,c,d,e,f,g){var h=document.title,i=null,j=1500,k=[],l=0,m=null,n=false;function o(){if(k.length>0){if(!n){p(k[l].title);l=++l%k.length;}else q();}else{clearInterval(m);m=null;q();}}function p(s){document.title=s;n=true;}function q(){r.set(i||h,true);n=false;}var r={get:function s(){return h;},set:function s(t,u){document.title=t;if(!u){h=t;i=null;c('Arbiter').inform('update_title',t);}else i=t;},blink:function s(t){var u={title:t};k.push(u);if(m===null)m=setInterval(o,j);return {stop:function v(){var w=k.indexOf(u);if(w>=0){k.splice(w,1);if(l>w){l--;}else if(l==w&&l==k.length)l=0;}}};}};f.exports=r;}),null);
__d('MercuryAttachmentSnippetType',['keyMirror'],(function a(b,c,d,e,f,g){var h=c('keyMirror')({PHOTO:null,GIF:null,VIDEO:null,AUDIO_CLIP:null,STICKER:null,SHARE:null,ERROR:null,MIXED:null,GIFT:null,THIRDPARTYSTICKER:null,FILE:null,LIKE_STICKER:null});f.exports=h;}),null);
__d('P2PSnippetStringUtils',['fbt','P2PPaymentRequestStatus','P2PTransferStatus'],(function a(b,c,d,e,f,g,h){var i={getRequestCanceledSnippet:function j(k,l,m,n,o){if(k){return h._("Votre demande de {payment request amount} de {receiver's name} a \u00e9t\u00e9 annul\u00e9e.",[h.param('payment request amount',o),h.param('receiver\'s name',n)]);}else if(l){return h._("La demande de {requester's name} de {payment request amount} a \u00e9t\u00e9 annul\u00e9e.",[h.param('requester\'s name',m),h.param('payment request amount',o)]);}else return h._("La demande de {payment request amount} de {requester's name} \u00e0 {receiver's name} a \u00e9t\u00e9 annul\u00e9e.",[h.param('requester\'s name',m),h.param('payment request amount',o),h.param('receiver\'s name',n)]);},getRequestDeclinedSnippet:function j(k,l,m,n,o){if(k){return h._("{receiver's name} a refus\u00e9 votre demande de {payment request amount}.",[h.param('receiver\'s name',n),h.param('payment request amount',o)]);}else if(l){return h._("Vous avez refus\u00e9 le demande de {payment request amount} de {requester's name}.",[h.param('requester\'s name',m),h.param('payment request amount',o)]);}else return h._("{receiver's name} a refus\u00e9 la demande de {payment request amount} de {sender's name}.",[h.param('receiver\'s name',n),h.param('sender\'s name',m),h.param('payment request amount',o)]);},getRequestSentSnippet:function j(k,l,m,n,o){if(k){return h._("Vous avez demand\u00e9 {amount} \u00e0 {requestee name}",[h.param('amount',o),h.param('requestee name',n)]);}else if(l){return h._("{requester name} vous a demand\u00e9 {amount}.",[h.param('requester name',m),h.param('amount',o)]);}else return h._("{name} a demand\u00e9 {amount} \u00e0 {requestee name}.",[h.param('name',m),h.param('amount',o),h.param('requestee name',n)]);},getRequestSnippetByStatus:function j(k,l,m,n,o,p){var q=k||c('P2PPaymentRequestStatus').INITED,r=[l,m,n,o,p];switch(q){case c('P2PPaymentRequestStatus').DECLINED:return this.getRequestDeclinedSnippet.apply(this,r);case c('P2PPaymentRequestStatus').TRANSFER_FAILED:case c('P2PPaymentRequestStatus').CANCELED:return this.getRequestCanceledSnippet.apply(this,r);}return this.getRequestSentSnippet.apply(this,r);},getTransferCanceledSnippet:function j(k,l,m,n,o){if(k){return h._("Votre paiement de {amount} \u00e0 {receiver_name} a \u00e9t\u00e9 annul\u00e9.",[h.param('amount',o),h.param('receiver_name',n)]);}else if(l){return h._("Le paiement de {amount} de {sender name} a \u00e9t\u00e9 annul\u00e9.",[h.param('sender name',m),h.param('amount',o)]);}else return h._("Le paiement de {amount} de {sender_name} \u00e0 {receiver_name} a \u00e9t\u00e9 annul\u00e9.",[h.param('sender_name',m),h.param('amount',o),h.param('receiver_name',n)]);},getTransferDeclinedSnippet:function j(k,l,m,n,o){if(k){return h._("{receiver_name} n\u2019a pas accept\u00e9 votre paiement de {amount}.",[h.param('receiver_name',n),h.param('amount',o)]);}else if(l){return h._("Vous avez refus\u00e9 le paiement de {amount} de {sender name}.",[h.param('sender name',m),h.param('amount',o)]);}else return h._("{receiver_name} n\u2019a pas accept\u00e9 le paiement de {amount} de {sender_name}.",[h.param('receiver_name',n),h.param('sender_name',m),h.param('amount',o)]);},getTransferSentSnippet:function j(k,l,m,n,o){if(k){return h._("Vous avez envoy\u00e9 {amount} \u00e0 {receiver name}.",[h.param('receiver name',n),h.param('amount',o)]);}else if(l){return h._("{name} vous a envoy\u00e9 {amount}.",[h.param('name',m),h.param('amount',o)]);}else return h._("{sender name} a envoy\u00e9 {amount} \u00e0 {receiver name}.",[h.param('sender name',m),h.param('receiver name',n),h.param('amount',o)]);},getTransferSnippetByStatus:function j(k,l,m,n,o,p){var q=[l,m,n,o,p],r=k||c('P2PTransferStatus').PENDING_SENDER_INITED;switch(r){case c('P2PTransferStatus').CANCELED_DECLINED:return this.getTransferDeclinedSnippet.apply(this,q);case c('P2PTransferStatus').CANCELED_SENDER_RISK:case c('P2PTransferStatus').CANCELED_RECIPIENT_RISK:case c('P2PTransferStatus').CANCELED_SYSTEM_FAIL:case c('P2PTransferStatus').CANCELED_EXPIRED:case c('P2PTransferStatus').CANCELED_SAME_CARD:return this.getTransferCanceledSnippet.apply(this,q);}return this.getTransferSentSnippet.apply(this,q);}};f.exports=i;}),null);
__d('MercuryAttachmentSnippetRenderer',['fbt','CurrentUser','MercuryAttachmentSnippetType','MercuryAttachmentType','MercuryAudioType','MercuryGiftSnippetRenderer','P2PSnippetStringUtils','StickerConstants','StoryAttachmentStyle'],(function a(b,c,d,e,f,g,h){'use strict';var i={getAttachmentSnippetType:function j(k){if(this._hasOnlyPhotos(k))return c('MercuryAttachmentSnippetType').PHOTO;if(this._hasOnlyAnimatedImages(k))return c('MercuryAttachmentSnippetType').GIF;if(this._hasOnlyVideo(k))return c('MercuryAttachmentSnippetType').VIDEO;if(this._hasAudioClip(k))return c('MercuryAttachmentSnippetType').AUDIO_CLIP;if(this._hasLikeSticker(k))return c('MercuryAttachmentSnippetType').LIKE_STICKER;if(this._hasSticker(k))return c('MercuryAttachmentSnippetType').STICKER;if(this._hasThirdPartySticker(k))return c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER;if(this._hasShare(k))return c('MercuryAttachmentSnippetType').SHARE;if(this._hasGift(k))return c('MercuryAttachmentSnippetType').GIFT;if(this._hasError(k))return c('MercuryAttachmentSnippetType').ERROR;if(this._hasFile(k))return c('MercuryAttachmentSnippetType').FILE;return c('MercuryAttachmentSnippetType').MIXED;},renderAttachmentSnippetText:function j(k,l,m,n){switch(k){case c('MercuryAttachmentSnippetType').PHOTO:return this._renderPhotoAttachmentSnippetText(l,m,this._getPhotoAttachments(n));case c('MercuryAttachmentSnippetType').GIF:return this._renderAnimatedImagesAttachmentSnippetText(l,m,this._getAnimatedImageAttachments(n));case c('MercuryAttachmentSnippetType').VIDEO:return l?h._("Vous avez envoy\u00e9 une vid\u00e9o."):h._("{sender name} a envoy\u00e9 une vid\u00e9o.",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').AUDIO_CLIP:return l?h._("Vous avez envoy\u00e9 un message vocal."):h._("{name} a envoy\u00e9 un message vocal.",[h.param('name',m)]);case c('MercuryAttachmentSnippetType').STICKER:case c('MercuryAttachmentSnippetType').LIKE_STICKER:case c('MercuryAttachmentSnippetType').THIRDPARTYSTICKER:return l?h._("Vous avez envoy\u00e9 un sticker."):h._("{name} a envoy\u00e9 un sticker.",[h.param('name',m)]);case c('MercuryAttachmentSnippetType').SHARE:if(n&&this._hasP2PPayment(n))return this._renderP2PPaymentSnippetText(n[0]);if(n&&this._hasP2PPaymentRequest(n))return this._renderP2PPaymentRequestSnippetText(n[0]);if(n&&this._hasBusinessMessage(n))return this._renderBusinessMessageSnippetText(n[0],m);if(n&&this._hasLocation(n))return l?h._("Vous avez envoy\u00e9 une position."):h._("{sender name} a envoy\u00e9 une position.",[h.param('sender name',m)]);if(n&&this._hasLiveLocation(n))return l?h._("Vous avez envoy\u00e9 une position en direct."):h._("{sender name} a envoy\u00e9 une position en direct.",[h.param('sender name',m)]);return l?h._("Vous avez envoy\u00e9 un lien."):h._("{sender name} en envoy\u00e9 un lien.",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').GIFT:return c('MercuryGiftSnippetRenderer').renderText(l,m);case c('MercuryAttachmentSnippetType').FILE:return l?h._("Vous avez envoy\u00e9 une pi\u00e8ce jointe."):h._("{sender name} a envoy\u00e9 une pi\u00e8ce jointe.",[h.param('sender name',m)]);case c('MercuryAttachmentSnippetType').ERROR:return l?h._("Vous avez envoy\u00e9 une pi\u00e8ce jointe."):h._("{sender name} a envoy\u00e9 une pi\u00e8ce jointe.",[h.param('sender name',m)]);default:return '';}},_hasOnlyPhotos:function j(k){return this._getPhotoAttachments(k).length===k.length;},_hasThirdPartySticker:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').THIRDPARTYSTICKER);},_hasOnlyAnimatedImages:function j(k){return this._getAnimatedImageAttachments(k).length===k.length;},_hasOnlyVideo:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').VIDEO);},_hasAudioClip:function j(k){var l=k[0].metadata&&k[0].metadata.type;return (k.length===1&&(l===c('MercuryAudioType').AudioClip||l===c('MercuryAudioType').VoiceMessageWithTranscript));},_hasBusinessMessage:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').BUSINESS_MESSAGE_ITEMS);},_hasSticker:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').STICKER);},_hasLikeSticker:function j(k){if(k.length<1)return false;var l=k[0].metadata&&k[0].metadata.stickerID;return (k.length===1&&(l==c('StickerConstants').LIKE_STICKER_ID||l==c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID||l==c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID||l==c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID));},_hasLocation:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').MESSAGE_LOCATION);},_hasLiveLocation:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').MESSAGE_LIVE_LOCATION);},_hasP2PPayment:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').ORION);},_hasP2PPaymentRequest:function j(k){return this._hasSingleShareAttachmentOfStyle(k,c('StoryAttachmentStyle').ORION_REQUEST);},_hasSingleShareAttachmentOfStyle:function j(k,l){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').SHARE&&k[0].share.style_list.indexOf(l)>=0);},_hasShare:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').SHARE);},_hasError:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').ERROR);},_hasGift:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').GIFT);},_hasFile:function j(k){return (k.length===1&&k[0].attach_type===c('MercuryAttachmentType').FILE);},_getPhotoAttachments:function j(k){if(!k)return [];return k.filter(function(l){return l.attach_type===c('MercuryAttachmentType').PHOTO;});},_getAnimatedImageAttachments:function j(k){if(!k)return [];return k.filter(function(l){return l.attach_type===c('MercuryAttachmentType').ANIMATED_IMAGE;});},_renderPhotoAttachmentSnippetText:function j(k,l,m){if(m.length===1){if(k){return h._("Vous avez envoy\u00e9 une photo.");}else return h._("{name} a envoy\u00e9 une photo.",[h.param('name',l)]);}else if(k){return h._({"*":"Vous avez envoy\u00e9 {num_photos} photos.","268435456":"Vous avez envoy\u00e9 {num_photos} photo."},[h.param('num_photos',m.length,[0])]);}else return h._({"*":"{name} a envoy\u00e9 {num_photos} photos."},[h.param('name',l),h.param('num_photos',m.length,[0])]);},_renderAnimatedImagesAttachmentSnippetText:function j(k,l,m){if(m.length===1){if(k){return h._("Vous avez envoy\u00e9 un GIF.");}else return h._("{name} a envoy\u00e9 un GIF.",[h.param('name',l)]);}else if(k){return h._("Vous avez envoy\u00e9 {num_animated_images} GIF.",[h.param('num_animated_images',m.length)]);}else return h._("{name} a envoy\u00e9 {num_animated_images} GIF.",[h.param('name',l),h.param('num_animated_images',m.length)]);},_renderBusinessMessageSnippetText:function j(k,l){var m=k.share.target,n=m&&m.message||h._("{sender name} a envoy\u00e9 une pi\u00e8ce jointe.",[h.param('sender name',l)]);return n;},_renderP2PPaymentSnippetText:function j(k){var l=k.share.target;return this.renderP2PPaymentSnippetText(c('CurrentUser').getID()===l.sender.id,l.sender.name,l.amountWithSymbol,l.status,c('CurrentUser').getID()===l.receiver.id,l.receiver.name);},_renderP2PPaymentRequestSnippetText:function j(k){var l=k.share.target;return this.renderP2PPaymentRequestSnippetText(c('CurrentUser').getID()===l.requester.id,l.requester.name,l.amountWithSymbol,l.currentStatus,c('CurrentUser').getID()===l.requestee.id,l.requestee.name);},renderP2PPaymentSnippetText:function j(k,l,m,n,o,p){return c('P2PSnippetStringUtils').getTransferSnippetByStatus(n,k,o||false,l||'',p||'',m);},renderP2PPaymentRequestSnippetText:function j(k,l,m,n,o,p){return c('P2PSnippetStringUtils').getRequestSnippetByStatus(n,k,o||false,l||'',p||'',m);}};f.exports=i;}),null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryBlockedParticipants1=j;this.$MercuryBlockedParticipants2=new (c('Set'))();this.$MercuryBlockedParticipants3=c('MercuryDispatcher').getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(k,l){if(l.message_blocked_ids)this.$MercuryBlockedParticipants2=new (c('Set'))(l.message_blocked_ids);var m=l.participants||[];for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.is_messenger_blocked===true)this.$MercuryBlockedParticipants4(r.fbid);if(r.is_messenger_blocked===false)this.$MercuryBlockedParticipants5(r.fbid);}}.bind(this));}h.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};h.prototype.setIDs=function(j){this.$MercuryBlockedParticipants2=j;};h.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};h.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};h.prototype.$MercuryBlockedParticipants4=function(j){this.$MercuryBlockedParticipants2.add(c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.$MercuryBlockedParticipants5=function(j){this.$MercuryBlockedParticipants2['delete'](c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.isMessageBlocked=function(j){if(!j.is_canonical)return false;var k=j.participants.filter(function(l){return l!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this));return !k.every(function(l){return !this.$MercuryBlockedParticipants2.has(l);}.bind(this));};h.prototype.isPresentInGroupThread=function(j){if(!j.is_canonical&&this.$MercuryBlockedParticipants7(j).length>0)return true;return false;};h.prototype.inGroupThread=function(j){if(j.is_canonical)return [];return this.$MercuryBlockedParticipants7(j);};h.prototype.$MercuryBlockedParticipants7=function(j){if(!j.participants)return [];var k=j.participants.filter(function(m){return m!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this)),l=k.filter(function(m){return this.$MercuryBlockedParticipants2.has(m)!==false;}.bind(this));return l;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=(u.is_forward||u.thread_id)&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=u.reaction&&v==c('MercuryActionType').REACTION_UPDATE,z=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,aa=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;j.debug('fetch_missing_messages',JSON.stringify({threadID:p,offset:q,limit:r,timestamp:fa,missingIndices:y,messageCount:aa,localMessageCount:ba}));this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(w.is_forward||r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages30(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y&&!y.is_forward){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages31(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages33(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages34(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages35(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages36(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages34(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}this.$MercuryMessages8&&j.debug('handle_updates',JSON.stringify({localMessageCounts:this.$MercuryMessages11}));};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages37(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages37=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages34(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages33=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages31=function(p,q){var r=this.$MercuryMessages38(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages38(p,q);this.$MercuryMessages37(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages38=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages35=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages34=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages34(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.map(function(r){return this.$MercuryMessages17(r);}.bind(this));return q.reverse();};l.prototype.$MercuryMessages36=function(p,q){var r=q.filter(function(s){return (m(this.$MercuryMessages17(s)));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get();function k(l,m){c('MercuryAssert').isThreadID(l);j.getThreadMeta(l,function(n){i.getThreadMessagesRange(l,0,1,function(o){var p=o.length&&o[o.length-1];if(p.log_message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST){m(h._("New contact added"));}else if(p&&p.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(p.author,function(q){var r=q.short_name;if(n.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(n.custom_nickname[s])r=n.custom_nickname[s];}if(n.name){m(h._("{senderName} a envoy\u00e9 un message \u00e0 {groupName}",[h.param('senderName',r),h.param('groupName',n.name)]));}else if(c('MercuryIDs').isGroupChat(l)){m(h._("{name} a envoy\u00e9 un message \u00e0 votre groupe",[h.param('name',r)]));}else m(h._("{name} vous a envoy\u00e9 un message",[h.param('name',r)]));});}else m(h._("Nouveau message\u00a0!"));});});}f.exports={renderDocumentTitle:k};}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y];if(z.is_forward)return 'continue';var aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){var ga=false;if(fa&&fa.last_read_timestamp)if(fa.last_read_timestamp>=z.timestamp)ga=true;if(!c('MercuryThreadInfo').isMuted(fa)&&!ga)t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MessengerStore',['MessengerDispatcher','mixInEventEmitter'],(function a(b,c,d,e,f,g){'use strict';function h(){this.$MessengerStore1=c('MessengerDispatcher').register(this.__onDispatch.bind(this));}h.prototype.getDispatchToken=function(){return this.$MessengerStore1;};h.prototype.emitChange=function(){this.emit('change');};h.prototype.destroy=function(){c('MessengerDispatcher').unregister(this.$MessengerStore1);};c('mixInEventEmitter')(h,{change:true});f.exports=h;}),null);
__d('MessengerSettingsStore',['CacheStorage','MessengerSettingsActions','MessengerStore','MessengerDotComSettingsInitialData'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=new (c('CacheStorage'))('localstorage'),k='desktopNotifsEnabled';h=babelHelpers.inherits(l,c('MessengerStore'));i=h&&h.prototype;function l(){i.constructor.call(this);this.$MessengerSettingsStore1=babelHelpers['extends']({},c('MessengerDotComSettingsInitialData'),{desktopNotifsEnabled:this.$MessengerSettingsStore2()});}l.prototype.getSettings=function(){return this.$MessengerSettingsStore1;};l.prototype.$MessengerSettingsStore2=function(){return j.get(k,false);};l.prototype.$MessengerSettingsStore3=function(m){j.set(k,m);};l.prototype.__onDispatch=function(m){switch(m.type){case c('MessengerSettingsActions').Types.CHANGE_SETTINGS:Object.assign(this.$MessengerSettingsStore1,m.newSettings);this.emitChange();break;case c('MessengerSettingsActions').Types.CHANGE_DESKTOP_NOTIFS:this.$MessengerSettingsStore1.desktopNotifsEnabled=m.desktopNotifsEnabled;this.$MessengerSettingsStore3(m.desktopNotifsEnabled);this.emitChange();break;}};f.exports=new l();}),null);
__d('MessengerStateStore',['MessengerActions','MessengerStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('MessengerStore'));i=h&&h.prototype;function j(){i.constructor.call(this);this.$MessengerStateStore1={activeThreadID:null,detailView:null,filter:null,folder:null,masterView:null,query:null,mid:null,serverThreadID:null};this.$MessengerStateStore2=babelHelpers['extends']({},this.$MessengerStateStore1);}j.prototype.getState=function(){return this.$MessengerStateStore1;};j.prototype.getPrevState=function(){return this.$MessengerStateStore2;};j.prototype.__onDispatch=function(k){switch(k.type){case c('MessengerActions').Types.REPLACE_STATE:this.$MessengerStateStore2=this.$MessengerStateStore1;this.$MessengerStateStore1=babelHelpers['extends']({activeThreadID:null,detailView:null,filter:null,folder:null,masterView:null,query:null,mid:null,serverThreadID:null},k.nextState);this.emitChange();break;}};f.exports=new j();}),null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],(function a(b,c,d,e,f,g){var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var o=m[h];if(o){o=JSON.parse(o);if(Array.isArray(o))return o;}}catch(n){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function m(n,o,p){n=c('createArrayFromMixed')(n);o=o||n[0]+Math.floor(Date.now()/1000);if(k(o))return;c('SoundPlayer').play(n,p);j(o);},isSupported:function m(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;}),null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],(function a(b,c,d,e,f,g){function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function j(k,l,m,n){var o={name:'SoundRPC',data:{paths:l,sync:m,loop:n}};k.postMessage(c('FBJSON').stringify(o),'*');},supportsRPC:function j(){return !!window.postMessage;},_listen:function j(){c('Event').listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l={};try{l=c('FBJSON').parse(k.data);}catch(m){}if(l.name==='SoundRPC')h(l.data.paths,l.data.sync,l.data.loop);});}};f.exports=i;}),null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],(function a(b,c,d,e,f,g){var h=null,i=false,j={init:function n(o){},play:function n(o,p,q){if(h){c('SoundRPC').playRemote(h.contentWindow,o,p,false);}else c('SoundRPC').playLocal(o,p,q);i=true;},hasPlayedSoundBefore:function n(){return i;},playOnlyIfImmediate:function n(o,p,q){if(!i&&c('Visibility').isHidden())return;this.play(o,p,q);},stop:function n(o){if(!h)c('SoundPlayer').stop(o);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;}),null);
__d('MessengerBrowserAlerts',['fbt','DocumentTitle','Event','ImageSourceRequest','ImageSourceType','Map','MercuryAttachmentSnippetRenderer','MercuryBlockedParticipants','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercuryThreadInfo','MercuryThreadInformer','MercuryThreads','MercuryUnseenState','MessagingTag','MessengerActions','MessengerConfig','MessengerDesktopNotifications','MessengerEnvironment','MessengerSettingsStore','MessengerStateStore','MercuryNotificationRenderer','PhotoResizeModeConst','Sound','URI','UserActivity'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryBlockedParticipants').get(),j=8000,k=80,l=3,m=600000,n='/images/messengerdotcom/favicon/favicon.ico',o='/images/messengerdotcom/favicon/unread_favicon.ico',p='/images/messengerdotcom/favicon/favicon_work.ico',q='/images/messengerdotcom/favicon/unread_favicon_work.ico',r='/images/messengerdotcom/favicon/favicon_sandbox.ico',s='/images/messengerdotcom/favicon/favicon_sandbox_unread.ico',t=new (c('Map'))(),u=0,v=null;function w(){t=new (c('Map'))();}function x(aa){if(c('MessengerSettingsStore').getSettings().sound_enabled)c('Sound').play([c('MessengerConfig')['sound.notif_ogg_url'],c('MessengerConfig')['sound.notif_mp3_url']],aa,false);}function y(aa,ba,ca){if(!aa.snippet_sender)return;var da=t.get(aa.thread_id)||0;if(da>=l)return;t.set(aa.thread_id,da+1);c('MercuryParticipants').get(aa.snippet_sender,function(ea){var fa=aa.snippet,ga=aa.custom_nickname&&aa.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(ea.id)],ha=ga?ga:ea.short_name;if(!fa&&aa.snippet_attachments&&aa.snippet_attachments.length>0)fa=c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetRenderer').getAttachmentSnippetType(aa.snippet_attachments),false,ha,aa.snippet_attachments);var ia=ga?ga:ea.name;if(!aa.is_canonical)ia=aa.name?h._("{sender's name} \u00e0 {group name}",[h.param('sender\'s name',ha),h.param('group name',aa.name)]):h._("{sender's name} \u00e0 votre groupe",[h.param('sender\'s name',ha)]);c('MessengerDesktopNotifications').showNotification({title:ia,body:fa,icon:aa.image_src||ba||ea.big_image_src||ea.image_src,closeTime:null,onClick:function ja(){window.focus();c('MessengerActions').selectThread(aa.thread_id);},tag:ca.message_id});if(!c('MessengerDesktopNotifications').hasDefaultSound())x(ca.timestamp);});}var z={init:function aa(ba){this._viewer=ba;this._threadInformer=c('MercuryThreadInformer').getForFBID(this._viewer);this._threads=c('MercuryThreads').getForFBID(this._viewer);this._unseenState=c('MercuryUnseenState').getForFBID(this._viewer);this._highResImageMap=new (c('Map'))();c('Event').listen(window,'focus',function(){w();clearInterval(u);});c('Event').listen(window,'blur',function(){u=setInterval(w,m);});this._threadInformer.subscribe('messages-received',function(ca,da){for(var ea in da)da[ea].forEach(function(fa){this.handleMessageReceived(fa);}.bind(this));}.bind(this));this._threadInformer.subscribe('unseen-updated',this._handleUnseenUpdated.bind(this));},handleMessageReceived:function aa(ba){if(ba.author===this._viewer||!ba.is_unread||ba.thread_id===c('MessengerStateStore').getState().activeThreadID&&c('UserActivity').isOnTab()||ba.folder!=c('MessagingTag').INBOX&&ba.folder!=c('MessagingTag').ARCHIVED)return;this._threads.getThreadMeta(ba.thread_id,function(ca){if(c('MercuryThreadInfo').isMuted(ca))if(!c('MercuryThreadInfo').areMentionsMuted(ca)){if(!ba.profile_ranges||!ba.profile_ranges.some||!ba.profile_ranges.some(function(da){return da.id===this._viewer;}.bind(this)))return;}else return;if(i.isPresentInGroupThread(ca))return;if(c('MessengerSettingsStore').getSettings().desktopNotifsEnabled&&!c('UserActivity').isOnTab()){this._attemptDesktopNotification(ca,ba);}else if(ba.log_message_type!==c('MercuryLogMessageType').UNSUBSCRIBE)x(ba.timestamp);if(!c('UserActivity').isOnTab()&&this._unseenState.getUnseenCount()>0)c('MercuryNotificationRenderer').renderDocumentTitle(ba.thread_id,function(da){if(!v)v=c('DocumentTitle').blink(da);});}.bind(this));},showRTCNotification:function aa(ba,ca){if(c('UserActivity').isOnTab()){ca(null);return;}var da=ba.peerID;if(!this._highResImageMap.has(da)){var ea=function(fa,ga){this._highResImageMap.set(da.toString(),ga.uri);this._displayRTCDesktopNotification(ga.uri,ba,ca);}.bind(this);new (c('ImageSourceRequest'))().setFBID(da).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(k,k).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(ea.bind(null,da)).send();}else this._displayRTCDesktopNotification(this._highResImageMap.get(da),ba,ca);},_updateFavicon:function aa(ba){if(c('MessengerEnvironment').facebookdotcom)return;var ca=document.querySelector('link[rel*=icon][href*=".ico"]'),da=c('URI').getRequestURI().getSubdomain()==='fb',ea=false;if(ba===0){if(ea){ca.href=r;}else if(da){ca.href=p;}else ca.href=n;return;}if(ea){ca.href=s;}else if(da){ca.href=q;}else ca.href=o;},_displayRTCDesktopNotification:function aa(ba,ca,da){var ea=c('MercuryIDs').getParticipantIDFromUserID(ca.peerID),fa=null;c('MercuryParticipants').get(ea,function(ga){var ha=void 0;if(ca.isVideoCall){ha=h._("Appel vid\u00e9o entrant");}else ha=h._("Appel vocal entrant");var ia=h._("{caller} vous appelle. Cliquez pour r\u00e9pondre.",[h.param('caller',ga.short_name)]);fa=c('MessengerDesktopNotifications').showNotification({title:ha,body:ia,icon:ba,closeTime:j,onClick:function ja(){window.focus();ca.onNotificationClicked();}});da(fa);});},_handleUnseenUpdated:function aa(){var ba=this._unseenState.getUnseenCount();if(c('UserActivity').isOnTab()&&c('UserActivity').isActive()&&ba>0){this._unseenState.markAsSeen();return;}var ca=c('DocumentTitle').get(),da=ba?'('+ba+') '+ca:ca;c('DocumentTitle').set(da,true);this._updateFavicon(ba);if(v&&ba===0){v.stop();v=null;}if(!this._focusToken&&ba>0)this._focusToken=c('UserActivity').subscribe(function(){if(c('UserActivity').isOnTab()){this._focusToken&&this._focusToken.unsubscribe();this._focusToken=null;this._unseenState.markAsSeen();}}.bind(this));},_attemptDesktopNotification:function aa(ba,ca){if(!ba.snippet_sender)return;if(!this._highResImageMap.has(ba.snippet_sender)){var da=function(ea,fa){this._highResImageMap.set(ba.snippet_sender,fa.uri);y(ba,fa.uri,ca);}.bind(this);new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(ba.snippet_sender)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(k,k).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(da.bind(null,ba.snippet_sender)).send();}else y(ba,this._highResImageMap.get(ba.snippet_sender),ca);}};f.exports=z;}),null);
__d('MessengerRTCIncomingDialog.react',['cx','fbt','ImageBlock.react','MercuryIDs','MercuryParticipants','MessengerActions','MessengerContactImage.react','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerSpinner.react','React','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerDialogBodyReact').comp,k=c('React').PropTypes,l=50,m=c('React').createClass({displayName:'MessengerRTCIncomingDialog',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{callerID:k.string.isRequired,onAccept:k.func.isRequired,onDecline:k.func.isRequired,isVideoCall:k.bool.isRequired},statics:{calculateState:function n(o){return {callerParticipant:c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(o.callerID))};}},render:function n(){return (c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:this._handleToggle,width:400},c('React').createElement(c('MessengerDialogHeader.react'),null,this._dialogTitle()),c('React').createElement(j,null,this._renderDialogBody()),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Refuser"),onClick:this._handleDecline,type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Accepter"),onClick:this._handleAccept,type:'primary'}))));},_dialogTitle:function n(){if(this.props.isVideoCall)return i._("Appel vid\u00e9o entrant");return i._("Appel audio entrant");},_renderDialogBody:function n(){var o=this.state.callerParticipant;if(!o)return c('React').createElement(c('MessengerSpinner.react'),null);return (c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(c('MessengerContactImage.react'),{isMessengerUser:o.is_messenger_user,size:l,src:o.big_image_src||o.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},i._("{caller name} vous appelle.",[i.param('caller name',o.name)])),c('React').createElement('div',{className:"_2n1t"},'The call will start as soon as you answer.'))));},_handleDecline:function n(event){event.preventDefault();c('MessengerActions').hideDialog(m);this.props.onDecline();},_handleAccept:function n(event){event.preventDefault();c('MessengerActions').hideDialog(m);this.props.onAccept();},_handleToggle:function n(o){if(!o){c('MessengerActions').hideDialog(m);this.props.onDecline();}}});f.exports=m;}),null);
__d('FBRTCSoundController',['RTCConfig','Sound'],(function a(b,c,d,e,f,g){var h=[c('RTCConfig').ringtone_mp3_url,c('RTCConfig').ringtone_ogg_url],i={playIncomingRingtone:function j(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');c('Sound').play(h,n,m);},stopIncomingRingtone:function j(){c('Sound').stop(h);}};f.exports=i;}),null);
__d('MessengerRTCIncomingDialogController',['BanzaiLogger','FBRTCConstants','FBRTCSoundController','MessengerRTCIncomingDialog.react','MessengerActions','MessengerBrowserAlerts','RTCConfig','mixInEventEmitter','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=70000;function i(j,k){this.$MessengerRTCIncomingDialogController1=j;this.$MessengerRTCIncomingDialogController2=k;this.$MessengerRTCIncomingDialogController3=null;this.$MessengerRTCIncomingDialogController4=null;this.$MessengerRTCIncomingDialogController5=false;}i.prototype.showIncomingDialog=function(j){this.timeout=c('setTimeoutAcrossTransitions')(this.$MessengerRTCIncomingDialogController6.bind(this),h);var k=j===c('FBRTCConstants').IncomingCallDialogTypes.VIDEO;c('FBRTCSoundController').playIncomingRingtone(this.$MessengerRTCIncomingDialogController2,this.$MessengerRTCIncomingDialogController1,true);c('MessengerActions').showDialog(c('MessengerRTCIncomingDialog.react'),{callerID:this.$MessengerRTCIncomingDialogController1.toString(),onAccept:this.$MessengerRTCIncomingDialogController7.bind(this),onDecline:this.$MessengerRTCIncomingDialogController8.bind(this),isVideoCall:k});if(c('RTCConfig').BrowserNotificationGK)this.$MessengerRTCIncomingDialogController9(k);};i.prototype.$MessengerRTCIncomingDialogController9=function(j){var k={peerID:this.$MessengerRTCIncomingDialogController1,onNotificationClicked:this.$MessengerRTCIncomingDialogController7.bind(this),isVideoCall:j};c('MessengerBrowserAlerts').showRTCNotification(k,function(l){this.$MessengerRTCIncomingDialogController4=l;if(this.$MessengerRTCIncomingDialogController5)this.$MessengerRTCIncomingDialogController10();}.bind(this));};i.prototype.cancel=function(){if(this.timeout)clearTimeout(this.timeout);c('MessengerActions').hideDialog(c('MessengerRTCIncomingDialog.react'));c('FBRTCSoundController').stopIncomingRingtone();if(this.$MessengerRTCIncomingDialogController4)this.$MessengerRTCIncomingDialogController10();this.$MessengerRTCIncomingDialogController5=true;};i.prototype.isForPeer=function(j){return this.$MessengerRTCIncomingDialogController1===j;};i.prototype.isForCall=function(j){return this.$MessengerRTCIncomingDialogController2===j;};i.prototype.isForPeerAndCall=function(j,k){return this.$MessengerRTCIncomingDialogController1===j&&this.$MessengerRTCIncomingDialogController2===k;};i.prototype.$MessengerRTCIncomingDialogController7=function(){this.cancel();c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'accept_call_click'});this.emit('answerCall',null);};i.prototype.$MessengerRTCIncomingDialogController8=function(){this.cancel();this.emit('ignoreCall');};i.prototype.$MessengerRTCIncomingDialogController6=function(){this.cancel();this.emit('timeout');};i.prototype.$MessengerRTCIncomingDialogController10=function(){this.$MessengerRTCIncomingDialogController4.close();this.$MessengerRTCIncomingDialogController4=null;};c('mixInEventEmitter')(i,{answerCall:true,ignoreCall:true,timeout:true});f.exports=i;}),null);
__d('MessengerRTCMissedCallDialog.react',['cx','fbt','ImageBlock.react','MercuryIDs','MercuryParticipants','MessengerActions','MessengerContactImage.react','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerSpinner.react','React','MNRTCCallabilityStore','StoreAndPropBasedStateMixin','Timestamp.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerDialogBodyReact').comp,k=c('React').PropTypes,l=50,m=c('React').createClass({displayName:'MessengerRTCMissedCallDialog',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'),c('MNRTCCallabilityStore'))],propTypes:{peerID:k.string.isRequired,timeMissed:k.number.isRequired},statics:{calculateState:function n(o){var p=o.peerID;return {calleeParticipant:c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(p))};}},render:function n(){return (c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:true,onToggle:this._handleToggle,shown:true,width:400},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Appel manqu\u00e9"))),c('React').createElement(j,null,this._renderBody()),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Fermer"),onClick:this._handleClose,type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Rappeler"),onClick:this._handleCallBack,type:'primary'}))));},_renderBody:function n(){var o=this.state.calleeParticipant;if(!o)return c('React').createElement(c('MessengerSpinner.react'),null);return c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(c('MessengerContactImage.react'),{isMessengerUser:o.is_messenger_user,size:l,src:o.big_image_src||o.image_src}),c('React').createElement('div',{className:"_2r2t"},c('React').createElement('div',{className:"_2r2u"},i._("Vous avez manqu\u00e9 un appel de {caller name}",[i.param('caller name',o.name)])),c('React').createElement('div',{className:"_2r2v"},c('React').createElement(c('Timestamp.react'),{time:this.props.timeMissed,autoUpdate:true}))));},_handleCallBack:function n(event){event.preventDefault();c('MessengerActions').hideDialog(m);var o=this.state.calleeParticipant;e(['FBRTCCore'],function(p){p.startOutgoingCall(o.fbid,'messenger_dot_com',false);});},_handleClose:function n(event){event.preventDefault();c('MessengerActions').hideDialog(m);},_handleToggle:function n(o){if(!o)c('MessengerActions').hideDialog(m);}});f.exports=m;}),null);
__d('MessengerRTCMissedCallDialogController',['MessengerActions','MessengerRTCMissedCallDialog.react'],(function a(b,c,d,e,f,g){'use strict';var h={onCallMissed:function i(j){this._missedCallPeerID=j;},showDialog:function i(){if(!this._missedCallPeerID)return;c('MessengerActions').showDialog(c('MessengerRTCMissedCallDialog.react'),{peerID:this._missedCallPeerID.toString(),timeMissed:Date.now()});},hideDialog:function i(){c('MessengerActions').hideDialog(c('MessengerRTCMissedCallDialog.react'));}};f.exports=h;}),null);
__d('MessengerRTCUnsupportedBrowserDialog.react',['fbt','React','MessengerActions','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','UserAgent','Link.react'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('messengerDialogBodyReact').comp;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$MessengerRTCUnsupportedBrowserDialog3=function(){return c('React').createElement(c('Link.react'),{onClick:this.$MessengerRTCUnsupportedBrowserDialog6,href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome');}.bind(this),this.$MessengerRTCUnsupportedBrowserDialog4=function(){return c('React').createElement(c('Link.react'),{onClick:this.$MessengerRTCUnsupportedBrowserDialog6,href:'https://www.mozilla.org/en-US/firefox/new/',target:'_blank'},'Mozilla Firefox');}.bind(this),this.$MessengerRTCUnsupportedBrowserDialog2=function(){if(c('UserAgent').isBrowser('IE'))return "Internet Explorer";if(c('UserAgent').isBrowser('Safari'))return "Safari";return "your browser";},this.$MessengerRTCUnsupportedBrowserDialog5=function(){c('MessengerActions').hideDialog(l);},this.$MessengerRTCUnsupportedBrowserDialog6=function(){c('MessengerActions').hideDialog(l);},this.$MessengerRTCUnsupportedBrowserDialog1=function(r){if(!r)c('MessengerActions').hideDialog(l);},n;}l.prototype.render=function(){return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.$MessengerRTCUnsupportedBrowserDialog1},c('React').createElement(c('MessengerDialogHeader.react'),null,h._("Changer de navigateur pour passer des appels")),c('React').createElement(k,null,h._("Malheureusement, {browser name, i.e. Internet Explorer or Safari} ne prend pas encore en charge notre nouvelle fonctionnalit\u00e9 d\u2019appel vid\u00e9o. Pour passer un appel, ouvrez Messenger.com dans {link to install chrome} ou {link to install firefox}.",[h.param('browser name, i.e. Internet Explorer or Safari',this.$MessengerRTCUnsupportedBrowserDialog2()),h.param('link to install chrome',this.$MessengerRTCUnsupportedBrowserDialog3()),h.param('link to install firefox',this.$MessengerRTCUnsupportedBrowserDialog4())])),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:h._("En savoir plus"),onClick:this.$MessengerRTCUnsupportedBrowserDialog5,type:'secondary',href:'https://www.facebook.com/help/211644178877843',target:'_blank'}),c('React').createElement(c('MessengerDialogButton.react'),{label:h._("OK"),onClick:this.$MessengerRTCUnsupportedBrowserDialog6,type:'primary'})));};f.exports=l;}),null);
__d('MessengerRTCUnsupportedBrowserDialogController',['MessengerRTCUnsupportedBrowserDialog.react','MessengerActions'],(function a(b,c,d,e,f,g){'use strict';var h={_dialog:null,showForIncomingCall:function i(j,k){c('MessengerActions').showDialog(c('MessengerRTCUnsupportedBrowserDialog.react'));},dismiss:function i(){c('MessengerActions').hideDialog(c('MessengerRTCUnsupportedBrowserDialog.react'));}};f.exports=h;}),null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('FBRTCDispatcher'));}j.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=j;}),null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','BanzaiLogger','ChannelConstants','FBRTCDispatcher','FBRTCStore','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=false,k=0,l=null,m='call_block_setting_changed';h=babelHelpers.inherits(n,c('FBRTCStore'));i=h&&h.prototype;n.prototype.init=function(o){this.$FBRTCCallBlockingStore1(o);c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};n.prototype.__onDispatch=function(o){if(o.type!==m)return;this.$FBRTCCallBlockingStore1(o.data);};n.prototype.$FBRTCCallBlockingStore1=function(o){switch(o){case 0:j=false;this.$FBRTCCallBlockingStore3();break;case -1:j=true;this.$FBRTCCallBlockingStore3();break;default:j=true;this.$FBRTCCallBlockingStore4(o);}this.__emitChange();};n.prototype.$FBRTCCallBlockingStore4=function(o){if(l===null)l=c('setTimeoutAcrossTransitions')(this.turnOnVideoCalling.bind(this),o*1000);};n.prototype.getBlockingStatus=function(){return j;};n.prototype.turnOnVideoCalling=function(){new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};n.prototype.turnOffVideoCalling=function(o){k=o;new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:o}).send();};n.prototype.$FBRTCCallBlockingStore3=function(){if(l){clearTimeout(l);l=null;}};n.prototype.$FBRTCCallBlockingStore5=function(){c('FBRTCDispatcher').dispatch({type:m,data:0});c('BanzaiLogger').log('VideoCallLoggerConfig',{event:m,message:'enable'});};n.prototype.$FBRTCCallBlockingStore6=function(){c('FBRTCDispatcher').dispatch({type:m,data:k});c('BanzaiLogger').log('VideoCallLoggerConfig',{event:m,message:'disable_'+k});};n.prototype.$FBRTCCallBlockingStore2=function(o,p){c('FBRTCDispatcher').dispatch({type:m,data:p.obj.value});};function n(){h.apply(this,arguments);}f.exports=new n();}),null);
__d('FBRTCSdpUtils',['UserAgent'],(function a(b,c,d,e,f,g){var h='m=video 0',i=function m(n){return n.match(/^a=rtpmap:(\d+)\s/)[1];},j=function m(n,o,p){var q=i(n[o]),r=n[p].split('RTP/SAVPF'),s=r[1].split(/\s+/),t=s.indexOf(q);s.splice(t,1);r[1]=s.join(' ');n[p]=r.join('RTP/SAVPF');n.splice(o,1);},k=function m(n,o,p){var q=i(n[o]);j(n,o,p);var r=new RegExp('^a=(rtcp-fb|fmtp):'+q+' ');n=n.filter(function(v){return !r.test(v);});var s=new RegExp('^a=fmtp:(\\d+)\\s+apt='+q+'($|;)'),t=n.reduce(function(v,w,x){var y=w.match(s);return y?[].concat(v,[y[1]]):v;},[]).join('|'),u=new RegExp('^a=rtpmap:('+t+')\\s+rtx/|^a=fmtp:('+t+')\\s+apt=');return n.filter(function(v){return !u.test(v);});},l={replaceRTPSAVPFProfile:function m(n){var o='UDP/TLS/RTP/SAVPF',p='RTP/SAVPF';while(n.indexOf(o)>=0)n=n.replace(o,p);return n;},addIceOptionToSdp:function m(n,o){"use strict";var p="a=ice-options:",q=n.indexOf(p);if(q>=0){var r=n.indexOf("\r",q);return [n.slice(0,r)," ",o,n.slice(r)].join('');}var s=p+o,t=n.split("\r\n"),u=false,v=-1;for(var w=0;w<t.length;w++){var x=t[w].slice(0,2);if(x=="s="){u=true;continue;}if(u&&x=="a="){v=w;break;}}if(v>=0){t.splice(v,0,s);return t.join("\r\n");}return [n,s,"\r\n"].join('');},preferIsac:function m(n){var o=n.split("\r\n"),p=-1,q=-1,r=-1;for(var s=0;s<o.length;s++){var t=o[s];if(t.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))p=s;if(r===-1&&p>-1&&t.match(/^a=rtpmap:/))r=s;if(t.match(/^a=rtpmap:\d+\s+ISAC\/16000/))q=s;}if(p===-1||q===-1||r===-1)return o.join("\r\n");var u=o[q];j(o,q,p);o.splice(r,0,u);o[p]=o[p].replace('RTP/SAVPF','RTP/SAVPF '+i(u));return o.join("\r\n");},disableVideo:function m(n){var o=/m=video\s+\S+/;n=n.replace(o,h);if(c('UserAgent').isBrowser('Firefox <= 37'))n=this._makeDisabledVideoReceiveOnly(n);return n;},_makeDisabledVideoReceiveOnly:function m(n){if(n.indexOf(h)>-1){var o=n.split(h);o[1]=o[1].replace(/send(recv|only)/,'recvonly');n=o.join(h);}return n;},fixMobileIceSdp:function m(n){n=n.replace(/^a=/,'');n=n.split(/\s+username\s+.+password.+/)[0];var o=n.match(/\s+relay\s+|\s+srflx\s+/),p=n.match(/raddr.+rport.+/);if(o&&!p){o=o[0];var q=n.split(o),r=q[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),s=void 0,t=void 0;if(r){s=r[1];t=r[2];q[1]=q[1].replace(r[0],'');}else{r=q[0].split(/\s+/);s=r[4];t=r[5];}n=''+q[0]+o+'raddr '+s+' rport '+t+' '+q[1];}return n;},addAudioNack:function m(n){var o=[];n=n.split('\r\n').map(function(p){var q='';if(o.length>0&&(/^a=rtpmap:(\d+)/.test(p)||/^a=ssrc/.test(p)||/^m=/.test(p))){q+=this._getrtcpFeedbackLinesFromAudioFMTs(o)+'\r\n';o=[];}if(/^m=audio/.test(p))o=p.match(/^m=audio\s+[\d\/]+\s+[\w\/]+([\s+\d+]+)/)[1].trim().split(' ');return q+p;}.bind(this)).join('\r\n');if(o.length>0)n+='\r\n'+this._getrtcpFeedbackLinesFromAudioFMTs(o);return n;},_getrtcpFeedbackLinesFromAudioFMTs:function m(n){return n.map(function(o){return 'a=rtcp-fb:'+o+' nack';}).join('\r\n');},removeFEC:function m(n){var o=n.split('\r\n'),p=void 0,q=void 0;for(var r=0;r<o.length;r++){if(o[r].match(/^a=rtpmap:\d+\s+red\//))p=r;if(o[r].match(/^m=video/))q=r;}if(p&&q)j(o,p,q);return o.join('\r\n');},removeH264:function m(n){var o=n.split('\r\n'),p=/^a=rtpmap:\d+\s+H264\//,q=o.findIndex(function(t){return p.test(t);}),r=/^m=video/,s=o.findIndex(function(t){return r.test(t);});return q!==-1&&s!==-1?k(o,q,s).join('\r\n'):n;},isVideoSupported:function m(n){return (n&&n.indexOf('m=video')>-1&&n.indexOf(h)===-1);},setDtlsRole:function m(n,o){if(!n.match(/setup:(active|passive|actpass)/)){return n.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+o);}else return n.replace(/setup:actpass/g,'setup:'+o);},setVideoBitrateConstraint:function m(n){var o=720;if(n.match(/^b=AS:/m))return n;n=n.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+o+'\r\n');return n;},removeSdparta:function m(n){var o=n.split('\r\n'),p='audio',q=false,r=-1;for(var s=0;s<o.length;s++){var t=o[s];if(t.indexOf('m=audio')===0)p='audio';if(t.indexOf('m=video')===0){q=true;p='video';}if(t.indexOf('a=mid:sdparta_')===0)o[s]='a=mid:'+p;if(t.indexOf('a=group:BUNDLE sdparta_')===0)r=s;}if(r>-1)if(q){o[r]='a=group:BUNDLE audio video';}else o[r]='a=group:BUNDLE audio';return o.join('\r\n');}};f.exports=l;}),null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCExperiment','FBRTCSdpUtils','FBRTCSupport','FBRTCUtils','UserAgent'],(function a(b,c,d,e,f,g){var h='mobile';function i(j){'use strict';if(!this.$FBRTCMessage1(j))throw new Error('invalid webrtc message');this.originalMessageData=j;this.peerID=j.from;this.callID=parseInt(j.call_id,10);this.msg=JSON.parse(j.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=j.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();this.$FBRTCMessage4();}i.prototype.$FBRTCMessage1=function(j){'use strict';return j.from&&j.call_id&&j.payload;};i.prototype.$FBRTCMessage2=function(){'use strict';if(c('FBRTCSupport').isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};i.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=c('FBRTCSdpUtils').disableVideo(this.msg.sdp);if(this.msgType===c('FBRTCConstants').PayloadType.SET_VIDEO||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ANSWER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};i.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE)this.msg.sdp=c('FBRTCSdpUtils').removeFEC(this.msg.sdp);};i.prototype.$FBRTCMessage4=function(){'use strict';if(this.isFromMobile()&&c('UserAgent').isBrowser('Chrome >= 52')&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE){var j=c('FBRTCExperiment').gen('rtc_browser_use_h264'),k=j.getParam('allow_h264','no');if(k!=='yes')this.msg.sdp=c('FBRTCSdpUtils').removeH264(this.msg.sdp);}};i.prototype.isOffer=function(){'use strict';return this.msgType===c('FBRTCConstants').PayloadType.OFFER;};i.prototype.isFromMobile=function(){'use strict';return this.source===h;};i.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE)return true;return c('FBRTCSdpUtils').isVideoSupported(this.msg.sdp);};i.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};i.prototype.isForCall=function(j){'use strict';return !j||j===this.callID||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE;};i.prototype.getSignalingExperiments=function(){'use strict';var j=this.msg.experiments;if(this.isFromMobile()&&!j)return ['sdp_update'];if(c('FBRTCUtils').isVCEndpointCallable(this.peerID))return ['screen_sharing'].concat(j||[]);return j;};f.exports=i;}),null);
__d("FBRTCMessageDedup",[],(function a(b,c,d,e,f,g){var h={},i={check:function j(k,l,m){if(!h[k])h[k]={};if(!h[k][l])h[k][l]={};if(h[k][l][m])return false;h[k][l][m]=true;return true;}};f.exports=i;}),null);
__d('ArtilleryTraceIDUtils',['Alea','ErrorUtils','ServerNonce'],(function a(b,c,d,e,f,g){var h='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',i=c('Alea')(c('ServerNonce').ServerNonce),j=function l(){var m=0,n=0,o='';for(var p=10;p>=0;p--){if(m<6){n=Math.floor(2147483648*i());m=32;}if(p===0)n&=7;o+=h.charAt(n&63);n>>=6;m-=6;}return o;},k={newTraceId:function l(){var m=void 0;for(var n=3;n>0;n--){m=j();if(m!=this.getDummyId())return m;}c('ErrorUtils').reportError(new Error('failed to generate valid Fbtrace id'));return this.getDummyId();},newObjectId:function l(){return this.newTraceId();},getDummyId:function l(){return 'AAAAAAAAAAA';},traceIdToBucket:function l(m){var n=m.charAt(m.length-1);return h.indexOf(n)%32;}};f.exports=k;}),null);
__d('BanzaiScribe',['Banzai'],(function a(b,c,d,e,f,g){function h(j){return {log:function k(l,m,n){var o=[m];if(n!=null)o.push(n);c('Banzai').post('scribe:'+l,o,j);}};}var i=h({});i.create=h;f.exports=i;}),null);
__d('SamplingPolicyBase',[],(function a(b,c,d,e,f,g){function h(){'use strict';throw new Error('Tried to instantiate SamplingPolicyBase');}h.prototype.getName=function(){'use strict';return this.name;};h.prototype.isSampled=function(){'use strict';if(typeof this.sampled=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};f.exports=h;}),null);
__d('FbtraceForcedByServerPolicy',['FbtraceForcedByServer','SamplingPolicyBase'],(function a(b,c,d,e,f,g){'use strict';var h=void 0;function i(){this.name='FbtraceForcedByServerPolicy';}i.get=function(){if(typeof h=='undefined')h=new i();return h;};function j(){return c('FbtraceForcedByServer').forced;}Object.assign(i.prototype,c('SamplingPolicyBase').prototype,{decideIfSampled:j});f.exports=i;}),null);
__d("guardFunction",[],(function a(b,c,d,e,f,g){function h(i,j,k){return function(){if(i.apply(k||this,arguments))j.apply(k||this,arguments);};}f.exports=h;}),null);
__d('Fbtrace',['Arbiter','ArtilleryTraceIDUtils','BanzaiScribe','FbtraceForcedByServer','FbtraceForcedByServerPolicy','SiteData','guardFunction'],(function a(b,c,d,e,f,g){'use strict';function h(){Object.assign(this,h);}Object.assign(h,{isOn:function s(){return false;},replySend:function s(t,u){},requestSend:function s(t,u,v){m(t,u);return {metadata:function w(){return undefined;},replyReceive:function w(x){}};}});var i=new h();function j(s,t,u){if(!s)throw {name:'ArgumentError',message:'no valid service name specified'};if(!t)throw {name:'ArgumentError',message:'no valid version specified'};var v=c('BanzaiScribe'),w=0,x=c('ArtilleryTraceIDUtils').newTraceId(),y=c('ArtilleryTraceIDUtils').newObjectId(),z=c('ArtilleryTraceIDUtils').traceIdToBucket(x),aa={service:s,version:t},ba=function ga(ha){if(typeof ha=='undefined')return 'undefined';if(typeof ha!='string')ha=ga(JSON.stringify(ha));return ha;},ca=function ga(ha){var ia='';for(var ja in ha){if(ia.length>0)ia+='\x02';ia+=ba(ja)+'\x03'+ba(ha[ja]);}return ia;},da=function ga(ha,ia,event,ja,ka){w++;return [ka,w,x,ha,ia,ba(event),ca(ja)].join('\x01');},ea=function ga(ha,ia,event,ja,ka){if(!ka&&typeof ka=='undefined')ka=Date.now()*1000;var la=da(ha,ia,event,ja,ka);v.log('fbtrace',la,z);},fa=function ga(){return y;};ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rqrecv',Object.assign(u||{},aa));Object.assign(this,j,{replySend:function ga(ha,ia){ia=babelHelpers['extends']({},ia,aa,{success:ha?'true':'false'});ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rpsend',ia);},requestSend:function ga(ha,ia,ja){m(ha,ia);var ka=fa(),la=c('ArtilleryTraceIDUtils').newObjectId();ja=babelHelpers['extends']({},ja,aa,{op:ha,'remote:service':ia});ea(ka,la,'#rqsend',ja);return {metadata:function ma(){return x+la;},replyReceive:function ma(na){ea(ka,la,'#rprecv',Object.assign(na||{},aa));},parentNode:this};}});}Object.assign(j,{isOn:function s(){return true;}});function k(){return i;}function l(s,t,u){u=u||{};u.init=true;var v=c('FbtraceForcedByServerPolicy').get();if(v.isSampled()){return new j(s,t,u);}else return new h();}function m(s,t){if(!s)throw {name:'ArgumentError',message:'no valid operation specified'};if(!t)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function n(s,t){var u=i,v=void 0;i=s;try{v=t();}finally{i=u;}return v;}var o=function s(t,u){var v=k(),w=u.request,x=false;if(!v.isOn()&&c('FbtraceForcedByServer').forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(w.uri.toString())){v=l('photo_upload_kludge',String(c('SiteData').revision||'dev'),{policy:'PhotoUpload'});x=true;}if(v.isOn()){var y=x?{policy:'PhotoUpload'}:{};if(w.userActionId)y.user_action_id=w.userActionId;var z=v.requestSend(w.uri.toString(),'www',y);w.fbtraceRemoteNode=z;w.transport.setRequestHeader('X-Fbtrace-Meta',z.metadata());}},p=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:true});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},q=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:false,error_code:u.response.error,error_summary:u.response.errorSummary,error_description:u.response.errorDescription});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},r=function s(t,u){return u.request.fbtraceRemoteNode;};c('Arbiter').subscribe('AsyncRequest/will_send',o);c('Arbiter').subscribe('AsyncRequest/response',c('guardFunction')(r,p));c('Arbiter').subscribe('AsyncRequest/error',c('guardFunction')(r,q));f.exports={defaultNode:k,requestReceive:l,withDefaultNode:n};}),null);
__d("XCollabCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/collab\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d("XVideoCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d('FBRTCMessageSender',['errorCode','CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController'],(function a(b,c,d,e,f,g,h){var i=0;function j(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=c('FBRTCLogger').getInstance();}j.prototype.sendOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.OFFER,k,l,m,n,o);};j.prototype.sendAnswer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.ANSWER,k,l,m,n,o);};j.prototype.sendPCRestartOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.PCRESTART_OFFER,k,l,m,n,o);};j.prototype.sendSdpUpdate=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.SDP_UPDATE,k,l,m,n,o);};j.prototype.resendSdpMessage=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender3(k,l);};j.prototype.resendPayload=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender4(k,l);};j.prototype.$FBRTCMessageSender2=function(k,l,m,n,o,p){'use strict';var q=this.$FBRTCMessageSender5(m,k);q.sdp=n;if(k===c('FBRTCConstants').PayloadType.OFFER){q.handlescollision=true;q.pranswer=false;}if(k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER){q.icerestart=false;q.experiments=c('FBRTCConfig').supportedSignalingExperiments();}q.videoon=o;q.attributes=p;q.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());this.$FBRTCMessageSender3(l,q);return q;};j.prototype.sendIceCandidate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.ICE_CANDIDATE);n.sdp_mid=m.sdpMid;n.label=m.sdpMLineIndex;n.sdp=m.candidate;if(m.isDirectScreenShareFromRecipient){n.attributes={};n.attributes.isDirectScreenShareFromRecipient=m.isDirectScreenShareFromRecipient;}this.$FBRTCMessageSender4(k,n);};j.prototype.sendHangup=function(k,l,m,n,o){'use strict';var p=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.HANGUP);p.reason=c('FBRTCConstants').callEndReasonString(m);p.subreason=o||'';this.$FBRTCMessageSender4(k,p,n);};j.prototype.sendOtherDismiss=function(k){'use strict';var l=this.$FBRTCMessageSender5(k,c('FBRTCConstants').PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(c('CurrentUser').getID(),l);};j.prototype.sendOfferAck=function(k,l,m){var n=arguments.length<=3||arguments[3]===undefined?new (c('Map'))():arguments[3];'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_ACK,n);};j.prototype.sendOfferNack=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_NACK,new (c('Map'))([['error_code',1356043]]));};j.prototype.sendAnswerAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ANSWER_ACK);};j.prototype.sendAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ACK,new (c('Map'))([['ack_type',m.type]]));};j.prototype.sendMuteStateUpdate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.SET_VIDEO);n.videoon=m;this.$FBRTCMessageSender4(k,n);};j.prototype.sendVideoEscalationRequest=function(k,l,m){'use strict';return this.sendVideoRequestResponse(k,l,0,m);};j.prototype.sendVideoRequestResponse=function(k,l,m,n){'use strict';var o=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.VIDEO_REQUEST);o.ack_id=m;o.videoon=n;o.capability=c('FBRTCSupport').getCapabilities();this.$FBRTCMessageSender4(k,o);return o;};j.prototype.sendMsgAck=function(){'use strict';};j.prototype.sendOk=function(){'use strict';};j.prototype.sendPranswer=function(){'use strict';};j.prototype.sendIcerestartAnswer=function(){'use strict';};j.prototype.$FBRTCMessageSender5=function(k,l){'use strict';var m=c('FBRTCUtils').generateRandomInt(),n={version:i,type:l,call_id:k,msg_id:m};if(this.$FBRTCMessageSender7(l))n.supports_video_interop=true;return n;};j.prototype.$FBRTCMessageSender7=function(k){'use strict';if(c('FBRTCSupport').isVideoInteropSupported())return (k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER||k===c('FBRTCConstants').PayloadType.PRANSWER||k===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||k===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER||k===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||k===c('FBRTCConstants').PayloadType.PCRESTART_ANSWER||k===c('FBRTCConstants').PayloadType.SDP_UPDATE||k===c('FBRTCConstants').PayloadType.SET_VIDEO||k===c('FBRTCConstants').PayloadType.VIDEO_REQUEST);return false;};j.prototype.$FBRTCMessageSender3=function(k,l){'use strict';this.$FBRTCMessageSender4(k,l,false,true,true);};j.prototype.$FBRTCMessageSender6=function(k,l,m,n){'use strict';var o=(arguments.length<=4?undefined:arguments[4])||new (c('Map'))(),p=this.$FBRTCMessageSender5(l,n);p.ack_id=m.msg_id;if(m.flag===1)p.flag=1;p.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());o.forEach(function(q,r,s){p[r]=q;});this.$FBRTCMessageSender4(k,p);};j.prototype.$FBRTCMessageSender4=function(k,l,m,n,o){'use strict';var p=l.msg_id,q={peer_id:k,call_id:l.call_id,msg_id:p,msg_type:l.type},r={call_id:l.call_id,msg_id:p,user_id:c('CurrentUser').getID(),recipient_id:k,msg_type:l.type,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'sendServerRequest:'+l.type,policy:'WebRTC'},s=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),r),t=(c('FBRTCUtils').isCollabCallable(k)?c('XCollabCallSendMessageController'):c('XVideoCallSendMessageController')).getURIBuilder().setInt('recipient_id',k).setInt('msg_id',p).setString('message_info',JSON.stringify(l)).setInt('webrtc_fbtrace',s.isOn()?1:0).getURI();if(n)var u=this.$FBRTCMessageSender4.bind(this,k,l,m,false,o);var v=this.$FBRTCMessageSender8.bind(this,q),w=this.$FBRTCMessageSender9.bind(this,q,u,o);c('Fbtrace').withDefaultNode(s,function(){c('FBRTCUtils').sendServerRequest(t,v,w,m);});if(this.onMessageSent)this.onMessageSent(k,l);this.$FBRTCMessageSender1.logSentMessage(k,l.call_id,l);};j.prototype.$FBRTCMessageSender8=function(k){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(k.peer_id,k.call_id,k.msg_type,k.msg_id);};j.prototype.$FBRTCMessageSender9=function(k,l,m,n){'use strict';if(n)var o=n.getError?n.getError():n;this.$FBRTCMessageSender1.logSentMessageFailure(k.peer_id,k.call_id,k.msg_type,k.msg_id,o);var p=null;if(o===1356001||o===1356049){p=c('FBRTCConstants').CallEndReason.NO_PERMISSION;}else if(o===1356046||o===1356045){p=c('FBRTCConstants').CallEndReason.CALLER_NOT_VISIBLE;}else if(o===1356003||o===1356002||o===1356044)p=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;if(!p&&l){l();return;}if(m&&this.onSendFailure){if(!p)p=c('FBRTCConstants').CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(p,o,k.msg_type);}};f.exports=j;}),null);
__d('FBRTCScreenSharingActions',['FBRTCDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({END_SESSION:null,SWITCH_SCREEN:null}),i=c('keyMirror')({SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),j={ConnectionEventTypes:i,ControlEventTypes:h,endSession:function k(){c('FBRTCDispatcher').dispatch({type:h.END_SESSION});},switchScreen:function k(){c('FBRTCDispatcher').dispatch({type:h.SWITCH_SCREEN});},sdpCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.SDP_CREATED,description:l});},remoteDescriptionSet:function k(){c('FBRTCDispatcher').dispatch({type:i.REMOTE_DESCRIPTION_SET});},localIceCandidateCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.LOCAL_ICE_CANDIDATE_CREATED,candidate:l});},remoteStreamAdded:function k(l){c('FBRTCDispatcher').dispatch({type:i.REMOTE_STREAM_ADDED,stream:l});},offerAckReceived:function k(){c('FBRTCDispatcher').dispatch({type:i.OFFER_ACK_RECEIVED});}};f.exports=j;}),null);
__d('FBRTCIncomingCallController',['fbt','Bootloader','Cache','DocumentTitle','FBRTCCallBlockingStore','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCCallUIWrapper','FBRTCConstants','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageSender','FBRTCScreenSharingActions','FBRTCUtils','Map','MercuryIDs','MercuryParticipants','UserActivity','FBRTCSupport'],(function a(b,c,d,e,f,g,h){var i=30;function j(k,l,m){'use strict';this.$FBRTCIncomingCallController1=k;this.$FBRTCIncomingCallController2=l;this.$FBRTCIncomingCallController3=m;this.$FBRTCIncomingCallController4=null;this.$FBRTCIncomingCallController5=null;this.$FBRTCIncomingCallController6=new (c('FBRTCMessageSender'))();this.$FBRTCIncomingCallController7=new (c('FBRTCLocalMessageQueue'))();this.$FBRTCIncomingCallController8=c('FBRTCCallSummaryStore').getInstance();this.$FBRTCIncomingCallController9=c('FBRTCLogger').getInstance();this.$FBRTCIncomingCallController10=null;this.$FBRTCIncomingCallController11=new (c('Cache'))();}j.prototype.onMessageReceived=function(k){'use strict';var l;try{l=new (c('FBRTCMessage'))(k);}catch(m){this.$FBRTCIncomingCallController9.logErrorWithoutID('Unknown data: '+JSON.stringify(k));return;}if(!c('FBRTCMessageDedup').check(l.peerID,l.callID,l.msgID)){if(l.isOffer()&&this.$FBRTCIncomingCallController12(l))this.$FBRTCIncomingCallController6.sendOfferAck(l.peerID,l.callID,l.msg);this.$FBRTCIncomingCallController9.logInfo(l.peerID,l.callID,'Ignoring message (duplicate): '+l.msgID);return;}this.$FBRTCIncomingCallController9.logReceivedMessage(l.peerID,l.callID,l.msg);if(c('FBRTCSupport').isWebrtcSupported()&&l.msgType!==c('FBRTCConstants').PayloadType.OFFER)this.$FBRTCIncomingCallController7.enqueueMessage(l.peerID,l.callID,l.msgID,k);switch(l.msgType){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCIncomingCallController13(l);break;case c('FBRTCConstants').PayloadType.HANGUP:this.$FBRTCIncomingCallController14(l);break;case c('FBRTCConstants').PayloadType.OTHER_DISMISS:this.$FBRTCIncomingCallController15(l);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCIncomingCallController16(l);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCIncomingCallController17(l);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:case c('FBRTCConstants').PayloadType.ANSWER:case c('FBRTCConstants').PayloadType.MSG_ACK:case c('FBRTCConstants').PayloadType.OK:case c('FBRTCConstants').PayloadType.PING:case c('FBRTCConstants').PayloadType.PRANSWER:case c('FBRTCConstants').PayloadType.ICERESTART_OFFER:case c('FBRTCConstants').PayloadType.ICERESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:case c('FBRTCConstants').PayloadType.ANSWER_ACK:case c('FBRTCConstants').PayloadType.SET_VIDEO:case c('FBRTCConstants').PayloadType.OFFER_NACK:case c('FBRTCConstants').PayloadType.VIDEO_REQUEST:case c('FBRTCConstants').PayloadType.ACK:break;default:break;}};j.prototype.$FBRTCIncomingCallController13=function(k){'use strict';var l=k.callID,m,n=k.msg,o=k.peerID,p=n.attributes&&n.attributes.hasOwnProperty('isDirectScreenShareFromRecipient');if(this.$FBRTCIncomingCallController18(l))return;if(n.calltype){this.$FBRTCIncomingCallController6.sendOfferNack(o,l,n);return;}if(this.$FBRTCIncomingCallController12(k)){var q=p?new (c('Map'))([['isDirectScreenShareFromRecipient',true]]):new (c('Map'))();this.$FBRTCIncomingCallController6.sendOfferAck(o,l,n,q);}else if(!c('FBRTCSupport').isWebrtcSupported()&&!p)this.$FBRTCIncomingCallController6.sendOfferNack(o,l,n);this.$FBRTCIncomingCallController9.logCallAction(o,l,c('FBRTCLogger').CallAction.RECEIVED_CALL);var r=this.$FBRTCIncomingCallController19(o,l,k);r.setUploadLogLevel(c('FBRTCUtils').getUploadLogLevel(c('FBRTCConstants').convertToUploadLogLevel(n.ull)));if(c('FBRTCCallBlockingStore').getBlockingStatus()){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.IGNORE_CALL,false,false,false,'calling disabled');return;}if(this.$FBRTCIncomingCallController4!==null&&!this.$FBRTCIncomingCallController4.isForPeer(o)){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.IN_ANOTHER_CALL,false,false,true);this.$FBRTCIncomingCallController3.onCallMissed(o);return;}if(!c('FBRTCSupport').isWebrtcSupported()){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION,false,false,false);this.$FBRTCIncomingCallController2.showForIncomingCall(l,o);return;}this.$FBRTCIncomingCallController4=new this.$FBRTCIncomingCallController1(o,l);this.$FBRTCIncomingCallController5=r;this.$FBRTCIncomingCallController4.addListener('answerCall',function(s){this.$FBRTCIncomingCallController21(o,l,k,r,s);}.bind(this));this.$FBRTCIncomingCallController4.addListener('ignoreCall',function(){this.$FBRTCIncomingCallController22(o,l,r);}.bind(this));this.$FBRTCIncomingCallController4.addListener('timeout',function(){this.$FBRTCIncomingCallController23(o,l,r,p,!p);}.bind(this));this.$FBRTCIncomingCallController3.hideDialog();if(p){m=c('FBRTCConstants').IncomingCallDialogTypes.SCREEN_SHARE;}else m=n.videoon?c('FBRTCConstants').IncomingCallDialogTypes.VIDEO:c('FBRTCConstants').IncomingCallDialogTypes.AUDIO;this.$FBRTCIncomingCallController4.showIncomingDialog(m);this.$FBRTCIncomingCallController9.logEvent(o,l,'Incoming call dialog shown');this.$FBRTCIncomingCallController24(o);};j.prototype.$FBRTCIncomingCallController17=function(k){'use strict';var l=k.msg.hasOwnProperty('isDirectScreenShareFromRecipient');if(l||c('FBRTCUtils').isCollabCallable(k.peerID))c('FBRTCScreenSharingActions').offerAckReceived();};j.prototype.$FBRTCIncomingCallController24=function(k){'use strict';if(!document.hasFocus())this.$FBRTCIncomingCallController25(k);};j.prototype.$FBRTCIncomingCallController26=function(){'use strict';this.$FBRTCIncomingCallController27();};j.prototype.$FBRTCIncomingCallController25=function(k){'use strict';var l=c('MercuryIDs').getParticipantIDFromUserID(k);c('MercuryParticipants').get(l,function(m){if(!this.$FBRTCIncomingCallController4)return;this.$FBRTCIncomingCallController10=c('DocumentTitle').blink(h._("{name} appelle",[h.param('name',m.short_name)]));}.bind(this));c('UserActivity').subscribeOnce(this.$FBRTCIncomingCallController27.bind(this));};j.prototype.$FBRTCIncomingCallController27=function(){'use strict';if(this.$FBRTCIncomingCallController10){this.$FBRTCIncomingCallController10.stop();this.$FBRTCIncomingCallController10=null;}};j.prototype.$FBRTCIncomingCallController28=function(){'use strict';if(this.$FBRTCIncomingCallController4)this.$FBRTCIncomingCallController4.cancel();this.$FBRTCIncomingCallController4=null;this.$FBRTCIncomingCallController5=null;this.$FBRTCIncomingCallController26();};j.prototype.$FBRTCIncomingCallController14=function(k){'use strict';var l=k.peerID,m=k.callID,n=k.msg;this.$FBRTCIncomingCallController29(m);if(this.$FBRTCIncomingCallController4&&this.$FBRTCIncomingCallController4.isForPeerAndCall(l,m)){var o=n.reason;if(typeof o=='string'||o instanceof String)o=c('FBRTCConstants').endCallReasonFromString(o);this.$FBRTCIncomingCallController20(l,m,this.$FBRTCIncomingCallController5,o,true,true,false);this.$FBRTCIncomingCallController28();if(o!==c('FBRTCConstants').CallEndReason.OTHER_INSTANCE_HANDLED){this.$FBRTCIncomingCallController3.onCallMissed(l);this.$FBRTCIncomingCallController3.showDialog();}}if(this.$FBRTCIncomingCallController30)this.$FBRTCIncomingCallController30.onDirectScreenSharingEndSession();};j.prototype.$FBRTCIncomingCallController12=function(k){'use strict';return c('FBRTCSupport').isWebrtcSupported();};j.prototype.$FBRTCIncomingCallController15=function(k){'use strict';var l=k.callID;this.$FBRTCIncomingCallController29(l);this.$FBRTCIncomingCallController2.dismiss();if(this.$FBRTCIncomingCallController4&&this.$FBRTCIncomingCallController4.isForCall(l))this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController29=function(k){'use strict';this.$FBRTCIncomingCallController11.set(k,true,null,i);};j.prototype.$FBRTCIncomingCallController18=function(k){'use strict';return this.$FBRTCIncomingCallController11.has(k);};j.prototype.$FBRTCIncomingCallController19=function(k,l,m){'use strict';var n=new (c('FBRTCCallSummary'))({peerID:k,callID:l,isCaller:false});n.onFullMessageReceived(m);n.onOfferAckSent(m.msg);return n;};j.prototype.$FBRTCIncomingCallController21=function(k,l,m,n,o){'use strict';if(m.msg.attributes&&m.msg.attributes.hasOwnProperty('isDirectScreenShareFromRecipient')){this.$FBRTCIncomingCallController31(k,l,m.msg.sdp);}else{var p=!m.msg.videoon;this.$FBRTCIncomingCallController9.logCallAction(k,l,c('FBRTCLogger').CallAction.ANSWER_CALL);this.$FBRTCIncomingCallController6.sendOtherDismiss(l);this.$FBRTCIncomingCallController7.enqueueOffer(k,m.originalMessageData);c('FBRTCCallUIWrapper').openAsCallee(k,l,n,o,p);}this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController31=function(k,l,m){'use strict';c('Bootloader').loadModules(["FBRTCScreenSharingController"],function(n){this.$FBRTCIncomingCallController30=new n(k,l,true);this.$FBRTCIncomingCallController30.initPromise.done(function(){this.$FBRTCIncomingCallController30.initializeAsReceiver(m,this.$FBRTCIncomingCallController7);}.bind(this));}.bind(this),'FBRTCIncomingCallController');};j.prototype.$FBRTCIncomingCallController22=function(k,l,m){'use strict';this.$FBRTCIncomingCallController20(k,l,m,c('FBRTCConstants').CallEndReason.IGNORE_CALL,false,true,true);this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController23=function(k,l,m,n,o){'use strict';this.$FBRTCIncomingCallController20(k,l,m,c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false,false,n);this.$FBRTCIncomingCallController28();if(o){this.$FBRTCIncomingCallController3.onCallMissed(k);this.$FBRTCIncomingCallController3.showDialog();}};j.prototype.$FBRTCIncomingCallController20=function(k,l,m,n,o,p,q){var r=arguments.length<=7||arguments[7]===undefined?null:arguments[7];'use strict';if(q)this.$FBRTCIncomingCallController6.sendHangup(k,l,n);if(p)this.$FBRTCIncomingCallController6.sendOtherDismiss(l);m.onCallEnded(n,o,null,r);m.save(this.$FBRTCIncomingCallController8);var s=c('FBRTCConstants').fullCallEndReasonString(n,o);this.$FBRTCIncomingCallController9.logCallAction(k,l,c('FBRTCLogger').CallAction.END_CALL,s);};j.prototype.$FBRTCIncomingCallController16=function(k){'use strict';var l=k.msg,m=l.attributes&&l.attributes.hasOwnProperty('isDirectScreenShareFromRecipient');if(m&&this.$FBRTCIncomingCallController30)this.$FBRTCIncomingCallController30.onSdpUpdateReceived(l.sdp);};f.exports=j;}),null);